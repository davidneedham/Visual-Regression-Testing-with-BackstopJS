<!DOCTYPE html>
<html lang="en">
<head>
	<title>Visual Regression Testing with BackstopJS</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="pantheon-theme/styles/screen-16x10.css">
	<!--<link rel="stylesheet" href="node_modules/shower-ribbon/styles/screen-16x10.css">
	-->
</head>
<body class="shower list no-page-numbers">

	<header class="caption">
		<h1>Visual Regression Testing with BackstopJS</h1>
		<p>Brought to you by the folks at Pantheon</p>
	</header>

	<section class="slide" id="cover">
		<div class="title">
			<div class="background"></div>
			<div class="text">
				<h2>Visual Regression Testing with BackstopJS</h2>
			</div>
		</div>
		<figure>
			<img class="cover" src="pantheon-theme/pictures/pantheon-office.jpg" alt="The Pagoda atop the Pantheon office">
			<figcaption class="white">
				<a href="http://www.twitter.com/getpantheon">@getpantheon</a>
			</figcaption>
		</figure>
	</section>

	<section class="slide bio image-r">
		<div class="text">
			<h2>Hi, I'm David</h2>
			<p>Developer Advocate at Pantheon</p>
			<p><strong>davidneedham</strong> on <a href="https://github.com/davidneedham/">GitHub</a> and <a href="https://www.twitter.com/davidneedham">Twitter</a></p>
			<p><a href="mailto:david.needham@pantheon.io">david.needham@pantheon.io</a></p>
			<p>Some things I enjoy are:</p>
				<ul>
					<li>Biking with my wife and kids</li>
					<li>Board games: <a href="http://is.gd/davidsgames">is.gd/davidsgames</a></li>
					<li>Volunteering in the community</li>
				</ul>
			<figure>
				<img class="cover" src="pictures/02-David-Needham-Pantheon.jpg" alt="David Needham">
			</figure>
		</div>
	</section>
<!-- PANTHEORS WHO WON'T BE HERE
	<section class="slide bio image-r">
		<div class="text">
			<h2>Hi, I'm Dwayne</h2>
			<p>Developer Advocate at Pantheon</p>
			<p><strong>mcdwayne</strong> on <a href="https://www.twitter.com/mcdwayne">Twitter</a>, <a href="https://www.drupal.org/u/mcdwayne">Drupal.org</a>, <a href="https://profiles.wordpress.org/mcdwayne">WordPress.org</a>, <a href="https://github.com/mcdwayne">GitHub</a></p>
			<p><a href="mailto:dwayne@pantheon.io">dwayne@pantheon.io</a></p>
			<p>Some things I enjoy are:</p>
				<ul>
					<li>Improv</li>
					<li>Karaoke</li>
					<li>Webcomics and comic books</li>
					<li>Finger knitting and crochet</li>
				</ul>
			<figure>
				<img class="cover" src="pictures/03-Dwayne-McDaniel-Pantheon.jpg" alt="David Needham">
			</figure>
		</div>
	</section>

	<section class="slide bio image-r">
		<div class="text">
			<h2>Hi, I'm Rachel</h2>
			<p>Senior Technical Writer at Pantheon</p>
			<p><strong>rachwhitton</strong> on <a href="https://www.twitter.com/RachWhitton">Twitter</a></p>
			<p>Some things I enjoy are:</p>
				<ul>
					<li>Camping</li>
					<li>Reading</li>
					<li>Gaming</li>
				</ul>
			<figure>
				<img class="cover" src="pictures/04-Rachel-Whitton-Pantheon.jpg" alt="Rachel Whitton">
			</figure>
		</div>
	</section> -->

	<section class="slide bio image-r">
		<div class="text">
			<h2>Hi, my name is...</h2>

				<ul>
					<li>Where are you from?</li>
					<li>What do you do with Drupal?</li>
					<li>Name one accomplishment.</li>
				</ul>
			<figure>
				<img width="540px" height="540px" class="cover" src="pictures/05-anonymous.svg" alt="Anonymous silhouette">
			</figure>
		</div>
	</section>

	<section class="slide">
		<h2>Agenda</h2>
		<table>
		<tr><td>Intro and setup</td></tr>
		<tr><td>Visual Regression Testing</td></tr>
		<tr><td>BackstopJS</td></tr>
		<tr><td>Continuous Integration</td></tr>
		<tr><td>Q&A // Breakout Sessions</td></tr>
		</table>
	</section>

	<section class="slide">
		<h2>Logistics</h2>
		<strong>You need:</strong>
		<ul>
			<li>A local dev environment with <a href="https://docs.npmjs.com/getting-started/installing-node">NodeJS/NPM</a></li>
			<li>A website with:</li>
			<ul>
				<li>A live, web-accessible website</li>
				<li>A local copy (or development site)</li>
			</ul>
			<li>Windows users need <a href="https://www.python.org/downloads/">Python</a> installed</li>
			<li>Afer class, install <a href="https://github.com/garris/BackstopJS">BackstopJS</a> globally to keep going</li>
		</ul>
	</section>

	<section class="slide subtitle">
		<div class="title">
			<div class="background"></div>
			<div class="text one-line">
				<h2>Visual Regression Testing</h2>
			</div>
		</div>

		<figure>
			<img class="cover" src="pictures/08-onions.jpg" alt="A bunch of onions">
		</figure>
	</section>

	<section class="slide">
		<h2>What is Visual Regression?</h2>
	</section>

	<section class="slide">
		<h2>re·gres·sion</h2>
		<p><strong>/rəˈɡreSH(ə)n/</strong></p>
		<p><em>noun</em></p>
		<ol><li>a return to a former or less developed state.</li></ol>
	</section>

	<section class="slide screenshot">
		<h2>Before:</h2>
		<figure>
			<img src="pictures/11-visual-regression-before.jpg" alt="A screenshot of a website before a change">
		</figure>
	</section>

	<section class="slide screenshot">
		<h2>After:</h2>
		<figure>
			<img src="pictures/12-visual-regression-after.jpg" alt="A screenshot of a website after a change">
		</figure>
	</section>

	<section class="slide screenshot">
		<h2>Side by side:</h2>
		<figure class="half first">
			<img src="pictures/11-visual-regression-before.jpg" alt="A screenshot of a website before a change">
		</figure>
		<figure class="half second last">
			<img src="pictures/12-visual-regression-after.jpg" alt="A screenshot of a website after a change">
		</figure>
	</section>

	<section class="slide screenshot">
		<h2>Difference:</h2>
		<figure>
			<img src="pictures/14-visual-regression-difference.jpg" alt="A screenshot of a website showing the differences highlighted">
		</figure>
	</section>

	<section class="slide image-r">
		<div class="text">
			<h2>Visual Regression: The New Pixel Perfect</h2>
			<ul>
				<li>The Power of Machine Vision</li>
				<li>Diligent Difference Detection</li>
				<li>Easy to create, quick to run</li>
				<li>Powered by Wraith or BackstopJS</li>
			</ul>
		</div>
		<figure>
			<img class="cover" src="pictures/15-visual-regression-report.jpg" alt="A screenshot of a generated visual regression report">
		</figure>
	</section>

	<section class="slide image-r">
		<div class="text">
			<h2>Visual Regression Benefits</h2>
			<ul>
				<li>"Reference vs Test" Comparison</li>
				<ul>
					<li>Reference (production)</li>
					<li>Test (environment to compare)</li>
				</ul>
				<li>Support for multiple viewports</li>
				<li>Easily scan your entire site</li>
				<li>Helpful error reporting</li>
				<li>Easy to write tests</li>
			</ul>
		</div>
		<figure>
			<img class="cover" src="pictures/16-Responsive_Web_Design_for_Desktop,_Notebook,_Tablet_and_Mobile_Phone.png" alt="A website on multiple devices">
		</figure>
	</section>

	<section class="slide image-r">
		<div class="text">
			<h2>Visual Regression Limitations</h2>
			<ul>
				<li>Lots of noise in the testing process</li>
				<li>High number of false negatives</li>
				<li>Difficulties with dynamic content</li>
			</ul>
		</div>
		<figure>
			<img class="cover" src="pictures/17-noisy-texture-300x300-o100-d11-c-ffffff-t0.jpg" alt="Static noise">
		</figure>
	</section>

	<section class="slide screenshot">
		<h2>Security updates as a killer use case</h2>
		<figure>
			<img src="pictures/18-D6-update-module-report.jpg" alt="Drupal 6 security updates available">
		</figure>
	</section>

	<section class="slide screenshot">
		<h2>Security updates & visual changes</h2>
		<figure class="half first">
			<img src="pictures/19-pantheondemo-before.jpg" alt="A screenshot of pantheondemo.com before updates">
		</figure>
		<figure class="half second last">
			<img src="pictures/19-pantheondemo-after.jpg" alt="A screenshot of pantheondemo.com after updates">
		</figure>
	</section>

	<section class="slide screenshot">
		<h2>What's the difference?</h2>
		<figure class="half first">
			<img src="pictures/19-pantheondemo-before.jpg" alt="A screenshot of pantheondemo.com before updates">
		</figure>
		<figure class="half second last">
			<img src="pictures/19-pantheondemo-after.jpg" alt="A screenshot of pantheondemo.com after updates">
		</figure>
	</section>

	<section class="slide screenshot">
		<h2>What's the difference? Nothing!</h2>
		<figure class="half first">
			<img src="pictures/19-pantheondemo-before.jpg" alt="A screenshot of pantheondemo.com before updates">
		</figure>
		<figure class="half second last">
			<img src="pictures/19-pantheondemo-after.jpg" alt="A screenshot of pantheondemo.com after updates">
		</figure>
	</section>

	<section class="slide subtitle">
		<div class="title">
			<div class="background"></div>
			<div class="text one-line">
				<h2>BackstopJS</h2>
			</div>
		</div>

		<figure>
			<img class="cover" src="pictures/22-backstop-bg.jpg" alt="The BackstopJS logo on a background">
		</figure>
	</section>

	<section class="slide">
		<h2>BackstopJS</h2>
		<strong>BackstopJS automates visual regression testing like a boss!</strong>
		<ul>
			<li>Render with headless Chrome, Phantom, and Slimer</li>
			<li>Simulate user interactions with ChromJS and CasperJS scripts</li>
			<li><strong>Browser reports with visual diffs</strong>, CLI reports and JUnit reports</li>
			<li>Plays nice with CI and source control</li>
			<li>Run globally or locally as a <strong>standalone packaged app with Node</strong></li>
			<li>Incredibly easy to use: just 3 commands go a long, long way!</li>
		</ul>
		<p><a href="https://github.com/garris/BackstopJS">github.com/garris/BackstopJS</a></p>
	</section>

	<section class="slide image-r">
		<div class="text">
			<h2>Clone the example repo</h2>
			<p>We've created <a href="https://github.com/davidneedham/Visual-Regression-Testing-BackstopJS-demo.git">an example repo</a> that we're going to clone to give you a jumpstart.</p>
			<p>There are detailed instructions in the README to run through this on your own next time. </p>
			<p>Today we're going to get started by cloning the repo:</p>
		</div>

		<code class="block">git clone https://github.com/davidneedham/Visual-Regression-Testing-BackstopJS-demo.git</code>
		<figure>
			<img class="cover" src="pictures/24-screencapture-github-davidneedham-Visual-Regression-Testing-BackstopJS-demo-2018-05-30-19_02_53.jpg" alt="A screenshot of the repo we're cloning">
		</figure>
	</section>

	<section class="slide">
		<div class="text">
			<h2>Run the example</h2>
			<ol>
				<li>Change into the folder <br /><code>cd Visual-Regression-Testing-BackstopJS-demo</code></li>
				<li>Checkout a new branch <br /><code>git checkout -b my-hacking-1</code></li>
				<li>Install Node dependencies <br /><code>npm install</code></li>
				<li>Run the example script <br /><code>npm run start</code></li>
				<li>Wait for the results (it should open in your browser automatically)</li>
			</ol>
		</div>
	</section>

	<section class="slide screenshot">
		<h2>Viewing the results</h2>
		<figure>
			<img src="pictures/26-hacking-step-1-results.jpg" alt="A screenshot showing the results of our first exercise">
		</figure>
	</section>

	<section class="slide screenshot">
		<h2>Backstop.json file</h2>
		<pre class="smaller"><code>
{
  "viewports": [
    {
      "name": "phone",
      "width": 320,
      "height": 480
    },
    {
      "name": "tablet_v",
      "width": 568,
      "height": 1024
    },
    {
      "name": "tablet_h",
      "width": 1024,
      "height": 768
    },
    {
      "name": "desktop",
      "width": 1920,
      "height": 1080
    }
  ],
  "scenarios": [
    {
      "label": "Homepage",
      "url": "https://dev-wp-quicksilver-demo.pantheonsite.io/",
      "referenceUrl": "https://scalewp.io/",
      "hideSelectors": [],
      "selectors": [
        "document"
      ],
      "readyEvent": null,
      "delay": 1500,
      "misMatchThreshold" : 0.1
    }
  ],
  "paths": {
    "bitmaps_reference": "backstop_data/bitmaps_reference",
    "bitmaps_test": "backstop_data/bitmaps_test",
    "compare_data": "backstop_data/bitmaps_test/compare.json",
    "casper_scripts": "backstop_data/casper_scripts"
  },
  "engine": "chrome",
  "report": [ "browser", "CI" ],
  "casperFlags": [],
  "debug": false,
  "port": 3001
}


</code></pre>
	</section>

	<section class="slide">
		<div class="text">
			<h2>Hacking the example (pt 1)</h2>
			<ul>
				<li>Edit <code>includes/backstop.json</code></li>
				<ul>
					<li>Set <code>referenceUrl</code> in <code>scenarios</code> to your production site URL</li>
					<li>Set <code>url</code> in <code>scenarios</code> to your local / development URL</li>
					<li>Start your local environment if needed</li>
				</ul>
				<li>Rerun the script with <code>npm run start</code></li>
				<li>Wait for the results (it should open in your browser automatically)</li>
			</ul>
		</div>
	</section>

	<section class="slide">
		<div class="text">
			<h2>Hacking the example (pt 2)</h2>
			<ul>
				<li>Edit <code>includes/backstop.json</code></li>
				<ul>
					<li>Try changing <code>viewports</code> or adding more <code>scenarios</code> to test other pages</li>
				</ul>
				<li>Update the website on your local / development URL</li>
				<li>Rerun the script with <code>npm run start</code></li>
				<li><strong>Is your updated site different than production?</strong></li>
			</ul>
		</div>
	</section>

	<section class="slide image-r">
		<div class="text">
			<h2>Scaling BackstopJS</h2>
			<p>We've tested one site at a time. What happens when you need to update all your sites? How can we scale BackstopJS?</p>
		</div>
		<figure>
			<img class="cover" width="400px" src="pictures/30-graph-up.png" alt="A clipart image of a graph going up">
		</figure>
	</section>

	<section class="slide">
		<div class="text">
			<h2>Running the multiple site example (pt 1)</h2>
			<ol>
				<li>Commit your existing changes<br /><code>git commit -am "All of my changes"</code></li>
				<li>Checkout the branch<br /><code>git checkout multiple-sites</code></li>
				<li>Checkout a new branch to work on<br /><code>git checkout -b my-hacking-2</code></li>
				<li>Re-install Node dependies<br /><code>npm install</code></li>
				<li>Rerun the example script<br /><code>npm run start</code> (and type a site name from the list when prompted)</li>
				<li>Wait for the results</li>
			</ol>
		</div>
	</section>

	<section class="slide">
		<div class="text">
			<h2>Running the multiple site example (pt 2)</h2>
			<ol>
				<li>Run the command <code>npm run start -- --all</code> (note the extra <code>--</code>)</li>
				<li>Wait for the results (from multiple sites!)</li>
				<li>Edit <code>includes/sitesToUpdate.js</code> (list of sites to test)</li>
				<ul>
					<li>Try changing to one (or more) of your sites</li>
					<li><code>BackstopReferenceBaseUrl</code> is your local / development URL</li>
					<li><code>BackstopTestUrl</code> is your production site URL</li>
					<li><code>pathsToTest</code> is the array of URIs to test for each site</li>
				</ul>
			</ol>
		</div>
	</section>

	<section class="slide">
		<div class="text">
			<h2>Running the multiple site example (notes)</h2>
			<ul>
				<li><code>npm run start</code> tests a single site</li>
				<li>Add <code> -- --site=my-cool-site</code> to specify a site (no prompt)</li>
				<li><code>npm run start -- --all</code> tests all the sites in <code>includes/sitesToUpdate.js</code></li>
				<li>Backstop config doesn't have to be hard-coded JSON</li>
				<ul>
					<li>See <code>includes/backstopConfig.js</code> for a dynamic configuration example</li>
				</ul>
			</ul>
		</div>
	</section>

	<section class="slide">
		<div class="text">
			<h2>Automatically configuring BackstopJS</h2>
			<p><a href="https://github.com/fffunction/backstop-crawl/">backstop-crawl</a> is a tool for automatically generating the <code>backstop.json</code> file by crawling a website with <a href="https://nodejs.org/en/">NodeJS</a>.</p>
			<p>Great for brochure and smaller sites without tons of pages.</p>
		</div>
		<figure>
			<img src="pictures/34-backstop-crawl.gif" alt="An animated gif showing backstop crawling pages on a website">
		</figure>
	</section>

	<section class="slide">
		<div class="text">
			<h2>backstop-crawl example</h2>
			<ol>
				<li>Commit your existing changes<br /><code>git commit -am "All of my changes"</code></li>
				<li>Checkout master<br /><code>git checkout master</code></li>
				<li>Checkout a new branch to work on<br /><code>git checkout -b my-hacking-3</code></li>
				<li>Install backstop-crawl<br /><code>npm install --global backstop-crawl</code></li>
				<li>Generate a new backstop.json file with backstop-crawl<br /><code>backstop-crawl http://live-needham-bikes.pantheonsite.io -o includes/backstop.json --ignore-robots --reference-url http://dev-needham-bikes.pantheonsite.io</code></li>
				<li>Rerun the script</li>
			</ol>
		</div>
	</section>

	<section class="slide image-r">
		<div class="text">
			<h2>Configuring BackstopJS Manually</h2>
			<ul>
				<li>Crawling isn't so great for larger sites with hundreds or thousands of pages.</li>
				<li>With large sites it is best to create a <code>backstop.json</code> manually covering the templates you need (single, archive, landing page, etc.)</li>
			</ul>
		</div>
		<figure>
			<img class="cover" src="pictures/36-custom-backstop-json.jpg" alt="A screenshot of the backstop.json file in GitHub">
		</figure>
	</section>

	<section class="slide subtitle">
		<div class="title">
			<div class="background"></div>
			<div class="text one-line">
				<h2>Continuous Integration</h2>
			</div>
		</div>
	</section>

	<section class="slide image-r">
		<div class="text">
			<h2>You can do this manually</h2>
			<ul>
				<li>Updates <strong>can</strong> be done manually</li>
				<li>Testing <strong>can</strong> be done manually</li>
			</ul>
			<p>If you can run a script while you brush your teeth, your sites can be as fresh as your mouth!</p>
		</div>
		<figure>
			<img class="cover" src="pictures/38-manual-labor.jpg" alt="A group of people pushing a heavy cart">
		</figure>
	</section>

	<section class="slide image-r">
		<div class="text">
			<h2>Set up a cron job</h2>
			<p>* */12 * * * /bin/bash /Users/me/Scripts/update-my-site.sh >/dev/null 2>&1</p>
		</div>
		<figure>
			<img class="cover" src="pictures/39-clock.svg" alt="A vector clock" width="300px" >
		</figure>
	</section>

	<section class="slide image-r">
		<div class="text">
			<h2>Make robots do the work!</h2>
			<ul>
				<li>Robots are happy to help</li>
				<li>Lots of benefits:</li>
					<ul>
						<li>Reliability</li>
						<li>Error logging</li>
						<li>Reporting</li>
						<li>"Greenfield" environments</li>
					</ul>
			</ul>
		</div>
		<figure>
			<img class="cover" src="pictures/40-robots.jpg" alt="David Needham">
		</figure>
	</section>

	<section class="slide image-r">
		<div class="text">
			<h2>Putting it together with CI</h2>
			<ul>
				<li>CircleCI makes it all happen!</li>
				<li>Easy to setup. Easy to configure.</li>
				<li>Let robots do the work!</li>
				<li>Share your work with others.</li>
			</ul>
		</div>
		<figure>
			<img class="cover" src="pictures/41-circle-ci.jpg" alt="David Needham">
		</figure>
	</section>

	<section class="slide image-r">
		<div class="text">
			<h2>CI Basics: Setup</h2>
			<ul>
				<li>Pick a Docker container</li>
				<ul><li>Preinstalled: Linux + NGINX + MariaDB + PHP</li></ul>
				<li>Define environmental variables</li>
				<ul>
					<li>API + Credentials</li>
					<li>Site specific information</li>
				</u>
			</ul>
		</div>
		<figure>
			<img class="cover" src="pictures/42-choices.jpg" alt="David Needham">
		</figure>
	</section>

	<section class="slide image-r">
		<div class="text">
			<h2>CI Basics: Build</h2>
			<ul>
				<li>Build necessary tooling</li>
				<ul><li>Install BackstopJS / other tools</li></ul>
				<li>Configure hosting platform</li>
				<ul>
					<li>Setup dev environments</li>
					<li>Copy production DB/Files</li>
				</u>
				<li>Apply udates to Dev</li>
				<ul>
					<li>Update Dev instance</li>
					<li>Notify via Slack</li>
				</u>
			</ul>
		</div>
		<figure>
			<img class="cover" src="pictures/43-build.jpg" alt="David Needham">
		</figure>
	</section>

	<section class="slide image-r">
		<div class="text">
			<h2>CI Basics: Test</h2>
			<ul>
				<li>Run testing</li>
				<ul><li>Visual regression, Behat, etc...</li></ul>
				<li>Determine success</li>
				<ul><li>Pass or fail?</li></ul>
				<li>Apply updates</li>
				<ul>
					<li>Update live instance</li>
					<li>Notify via Slack</li>
				</u>
			</ul>
		</div>
		<figure>
			<img class="cover" src="pictures/44-test.jpg" alt="David Needham">
		</figure>
	</section>

	<section class="slide image-r">
		<div class="text">
			<h2>CI: Real world example</h2>
			<p><a href="https://github.com/pantheon-systems/example-terminus-auto-update-script">Pantheon Example Terminus Auto Update Script</a></p>
		</div>
		<figure>
			<img class="cover" src="pictures/45-Pantheon-Example-Terminus-Auto-Update-Script-on-Github.jpg" alt="A screenshot of the github repo for Pantheon Example Terminus Auto Update Script">
		</figure>
	</section>

	<section class="slide subtitle">
		<div class="title">
			<div class="background"></div>
			<div class="text one-line">
				<h2>Q&A</h2>
			</div>
		</div>
	</section>

	<section class="slide subtitle">
		<div class="title">
			<div class="background"></div>
			<div class="text one-line">
				<h2>Breakout sessions</h2>
			</div>
		</div>
	</section>

	<footer class="badge">
		<!--<a href="https://github.com/davidneedham/Visual-Regression-Testing-with-BackstopJS">Fork this on GitHub</a>-->
	</footer>

	<div class="progress"></div>

	<script type="application/javascript" src="shower/shower.min.js"></script>
	<!-- Copyright © 2018 Yours Truly, Famous Inc. -->

</body>
</html>
